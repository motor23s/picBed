# 现有防盗刷机制说明

1. 渠道规则：针对各预付费渠道，会有一些特殊的设备特征（DeviceInfo）规则以及配套的白名单，不符合这些规则的设备将被判定为非法访问；
2. 白名单： 预付费产品的MAC+CPU serial number，厂家提供，可能存在少量缺失或重复记录；部分预装产品，厂家提供MAC+CPU serial number；
3. 黑名单：已经确定为黑产的MAC，将直接导致该MAC无法登录和访问服务；
4. 未知，对于无从判断的MAC和CPU serial number，基本采取放过的策略（判定为后装）；
# 主要漏洞来源
1. 早期型号的设备特征信息不齐全，因此系统规则较为宽松，往往被黑产复制和利用；
2. 黑产的复制技术升级，目前已有案例表明（甚至在youtube出现破解教程），黑产可以完全复制一台合法预付费设备。
# 解决方案
1. 建立或者说完善会话服务
- 已有的判定体系基本是基于设备特征码实现的，设备特征相同则基本无法判定“多登”；
- 把会话id（根据单次会话分配的唯一标识）+设备特征码作为辨识唯一用户的标识；
- 同一设备特征码同时登入默认仅允许1台，作为后台可配置项；
- 建立客户端存活（心跳）服务（可选，优先级较低），将会话控制粒度做到准实时（可以更快踢出非法用户，“多登”判定更准确）
2. 三端踢出机制
- API服务端，在客户端“心跳”请求时，判定“多登”状态，并对非法设备下发“踢出”指令；
- APK客户端，接收到“踢出”指令时，退出客户端登录（已有，验证）；
- Media服务端，在媒体集群导航服务模块，增加向会话服务请求“多登”判定，对非法设备进行断连；
3. 实施难点
- 增加或者改造会话服务，尽可能在服务端、特别是媒体端约束非法设备；灰度会需要一定周期（客户端覆盖周期会更长）；
- 客户端灰度和覆盖周期很长，尽可能不改变客户端接口，或者在基本达成阻断“多登”产业的目的下，逐步灰度功能；
- 由于媒体服务的P2P机制，可能出现客户端直接从“邻居”处获得媒体流的情况，因此，三端踢出机制还是应当共同实施。